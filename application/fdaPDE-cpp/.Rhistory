mesh <- create.mesh.2D(nodes = Bounds, order = 1)
mesh <- refine.mesh.2D(mesh, maximum_area = 0.2)
FEMbasis <- create.FEM.basis(mesh)
set.seed(10)

n <- 50
data_x <- rnorm(n)
data_y <- rnorm(n)
data <- cbind(data_x, data_y)

lambda = c(0.001, 0.01, 0.1, 1)
nfolds = 5
sol <- DE.FEM(data = data, FEMbasis = FEMbasis, lambda = lambda, nfolds=nfolds, 
              step_method = "Fixed_Step", direction_method = "BFGS",
              preprocess_method="RightCV", tol1 = 1e-15, tol2 = 1e-5, stepProposals = 1e-2)
lambda = c(0.001, 0.01, 0.1, 1)
nfolds = 5
sol <- DE.FEM(data = data, FEMbasis = FEMbasis, lambda = lambda, nfolds=nfolds, 
              step_method = "Fixed_Step", direction_method = "Gradient",
              preprocess_method="RightCV", tol1 = 1e-15, tol2 = 1e-5, stepProposals = 1e-2)
sol$cv_err
names(sol)
sol$CV_err
lambda = c(0.1, 0.01)
nfolds = 5
sol <- DE.FEM(data = data, FEMbasis = FEMbasis, lambda = lambda, nfolds=nfolds, 
              step_method = "Fixed_Step", direction_method = "Gradient",
              preprocess_method="RightCV", tol1 = 1e-15, tol2 = 1e-5, stepProposals = 1e-2)
q()
n
library(fdaPDE)
Xbound <- seq(-3, 3, length.out = 10)
Ybound <- seq(-3, 3, length.out = 10)
grid_XY <- expand.grid(Xbound, Ybound)
Bounds <- grid_XY[(grid_XY$Var1 %in% c(-3, 3)) | (grid_XY$Var2 %in% c(-3, 3)), ]
mesh <- create.mesh.2D(nodes = Bounds, order = 1)
mesh <- refine.mesh.2D(mesh, maximum_area = 0.2)
FEMbasis <- create.FEM.basis(mesh)

set.seed(10)

n <- 50
data_x <- rnorm(n)
data_y <- rnorm(n)
data <- cbind(data_x, data_y)


lambda = c(0.01, 0.1)
nfolds = 5
sol <- DE.FEM(data = data, FEMbasis = FEMbasis, lambda = lambda, nfolds=nfolds, 
              step_method = "Fixed_Step", direction_method = "Gradient",
              preprocess_method="RightCV", tol1 = 1e-15, tol2 = 1e-5, stepProposals = 1e-2)
q()
n
library(Matrix)
M <- readMM("test/build/result.mtx")
image(matrix(M[,1], nrow = 21, ncol = 21))
image(matrix(M[(1:441) + t*441,1], nrow = 21, ncol = 21))
image(matrix(M[((1:441) + t*441),1], nrow = 21, ncol = 21))
t = 0
image(matrix(M[((1:441) + t*441),1], nrow = 21, ncol = 21))
x = seq(0,1, length.out = 21)
y = x
locations = expand.grid(x,y)

mesh = create.mesh.2D(locations)
plot(mesh)

nnodes = dim(mesh$nodes)[1]

FEMbasis = create.FEM.basis(mesh)

f = function(x, y, z)
{
  x = x/2
  y = y/2
  coe = function(x,y) 1/2*sin(5*pi*x)*exp(-x^2)+1
  sin(2*pi*(coe(y,1)*x*cos(z-2)-y*sin(z-2)))*cos(2*pi*(coe(y,1)*x*cos(z-2+pi/2)+coe(x,1)*y*sin((z-2)*pi/2)))
}

NumTimePoints=11
TimePoints=seq(0,2,length.out = NumTimePoints)
library(fdaPDE)
x = seq(0,1, length.out = 21)
y = x
locations = expand.grid(x,y)

mesh = create.mesh.2D(locations)
plot(mesh)

nnodes = dim(mesh$nodes)[1]

FEMbasis = create.FEM.basis(mesh)

f = function(x, y, z)
{
  x = x/2
  y = y/2
  coe = function(x,y) 1/2*sin(5*pi*x)*exp(-x^2)+1
  sin(2*pi*(coe(y,1)*x*cos(z-2)-y*sin(z-2)))*cos(2*pi*(coe(y,1)*x*cos(z-2+pi/2)+coe(x,1)*y*sin((z-2)*pi/2)))
}

NumTimePoints=11
TimePoints=seq(0,2,length.out = NumTimePoints)
SpacePoints=mesh$nodes
SpaceTimePoints=cbind(rep(mesh$nodes[,1],NumTimePoints),rep(mesh$nodes[,2],NumTimePoints),rep(TimePoints,each=nrow(mesh$nodes)))

sol_exact=f(SpaceTimePoints[,1],SpaceTimePoints[,2],SpaceTimePoints[,3])
image(matrix(M[((1:441) + t*441),1] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
dev.new()
image(matrix(M[((1:441) + t*441),2] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
t = 5
dev.new()
image(matrix(M[((1:441) + t*441),1] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
dev.new()
image(matrix(M[((1:441) + t*441),2] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
M <- readMM("test/build/result.mtx")
image(matrix(M[((1:441) + t*441),1] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
t = 0
image(matrix(M[((1:441) + t*441),1] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
image(matrix(M[((1:441) + t*441),2] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
head(M)
tail(M)
M <- as.matrix(M)
sqrt(mean((M[,1] - sol_exact[,1])^2))
sqrt(mean((M[,1] - sol_exact)^2))
sqrt(mean((M[,2] - sol_exact)^2))
M <- readMM("test/build/result.mtx")
M <- as.matrix(M)
sqrt(mean((M[,1] - sol_exact)^2))
M <- readMM("test/build/result.mtx")
M <- as.matrix(M)
sqrt(mean((M[,1] - sol_exact)^2))
image(matrix(M[((1:441) + t*441),1] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
M <- readMM("test/build/result.mtx")
M <- as.matrix(M)
sqrt(mean((M[,1] - sol_exact)^2))
M <- readMM("test/build/result.mtx")
M <- as.matrix(M)
sqrt(mean((M[,1] - sol_exact)^2))
M[1:441, 1] - sol_exact[1:441]
range(M[1:441, 1] - sol_exact[1:441])
range(M[1:441, 2] - sol_exact[1:441])
M <- readMM("test/build/result.mtx")
M <- as.matrix(M)
sqrt(mean((M[,1] - sol_exact)^2))
M <- readMM("test/build/result.mtx")
M <- as.matrix(M)
sqrt(mean((M[,1] - sol_exact)^2))
sqrt(mean((M[,2] - sol_exact)^2))
image(matrix(M[((1:441) + t*441),1] - sol_exact[((1:441) + t*441)], nrow = 21, ncol = 21))
image(matrix(M[((1:441) + t*441),1]], nrow = 21, ncol = 21))
image(matrix(M[((1:441) + t*441),1]), nrow = 21, ncol = 21))
image(matrix(M[((1:441) + t*441),1], nrow = 21, ncol = 21))
t = 5
image(matrix(M[((1:441) + t*441),1], nrow = 21, ncol = 21))
dev.new()
image(matrix(M[((1:441) + t*441),2], nrow = 21, ncol = 21))
q()
n
library(Matrix)
M <- readMM("test/build/result.mtx")
M
M1 <- readMM("test/build/result1.mtx")
M2 <- readMM("test/build/result2.mtx")
M1
q()
n
q()
n
library(data.table)
elem <- fread("../../università/articoli/neurocose/mesh/elem_onlygm.csv")
elem <- as.matrix(elem)
ls
head(elem)
elem <- elem[1:4,]
head(elem)
elem <- fread("../../università/articoli/neurocose/mesh/elem_onlygm.csv")
elem <- as.matrix(elem)
elem <- elem[,1:4]
head(elem)
fwrite(elem, file = "../../università/articoli/neurocose/mesh/elem_onlygm2.csv")
q()
n
library(data.table)
elem <- fread("../../università/articoli/neurocose/mesh/elem_onlygm.csv")
elem <- as.matrix(elem)
dim(elem)
data <- as.matrix(fread("../../università/articoli/neurocose/neurodata.csv"))
is(data)
q()
n
library(data.table)
data <- as.matrix(fread("../../università/articoli/neurocose/neurodata.csv"))
data <- t(data)
dim(data)
fwrite(data, file = "../../università/articoli/neurocose/neurodata_transpose.csv")
q()
n
library(Matrix)
scores <- Matrix::readMM("test/build/neuro_scores.mtx")
scores <- as.matrix(scores)
plot(scores[,1], scores[,2])
plot(scores[,1], scores[,3])
plot(scores[,2], scores[,3])
plot(scores[,1], scores[,2])
plot(scores[1:24,1], col = "red")
plot(scores[25:50,1], col = "blue")
size(scores)
length(scores)
dim(scores)
plot(scores[25:49,1], col = "blue")
points(scores[1:24,1], col = "red")
plot(scores[25:49,1], scores[25:49,2], col = "blue")
points(scores[1:24,1], scores[1:24, 2], col = "red")
loadings <- Matrix::readMM("test/build/neuro_loadings.mtx")
loadings <- as.matrix(loadings)
dim(loadings)
get_load <- function(loc, lod) { return(loadings[seq(from = 1, to = 128, by = 36035) + loc, lod]) }
a <- get_load(20000, 1)
plot(a, type = "l")
a
get_load <- function(loc, lod) { return(loadings[seq(from = 1, to = dim(loadings)[1], by = 36035) + loc, lod]) }
a
a <- get_load(20000, 1)
a
plot(a, type = "l")
plot(-a, type = "l")
b <- get_load(20000, 2)
dev.new()
plot(b, type = "l")
plot(-b, type = "l")
c <- get_load(20000, 3)
dev.new()
plot(c, type = "l")
c <- get_load(30000, 3)
c <- get_load(30000, 2)
dev.new()
plot(c, type = "l")
a <- get_load(30000, 1)
dev.new()
plot(a, type = "l")
q()
n
library(Matrix)
scores <- Matrix::readMM("test/build/neuro_scores.mtx")
plot(scores[1:24,1], scores[1:24, 2], col = "red")
points(scores[25:49,1], scores[25:49, 2], col = "blue")
plot(scores)
plot(scores[,1], scores[,2])
get_load <- function(loc, lod) { return(loadings[seq(from = 1, to = dim(loadings)[1], by = 36035) + loc, lod]) }
loadings <- Matrix::readMM("test/build/neuro_loadings.mtx")
scores <- as.matrix(scores)
plot(scores[,1], scores[,2])
scores
loadings <- as.matrix(loadings)
a <- get_load(30000, 1)
plot(a, type = "l")
a <- get_load(20000, 1)
plot(a, type = "l")
dev.new()
a <- get_load(20000, 2)
plot(a, type = "l")
b <- -get_load(20000, 1)
dev.new()
plot(b, type = "l")
dev.new(); plot(scores[,1], scores[,2])
length(b)
tail(loadings)
q()
n
qbern
qbern()
library(multinma)
library(stats)
qgamma
qbern
qnorm
q()
n
dim(meshr$nodes)
plot(meshr)
plot(meshr)
head(ExactData)
nrow(locations)
write.csv(format(ExactData, digits = 16), "true_obs.csv")
dim(space_time_locations)
head(data_mat)
numIter
head(data_mat)
time_locs
dim(time_locs)
length(time_locs)
getwd()
head(sol)
head(sol)
rmse_vec_dire
rmse_vec_iter
graphics.off()
q()
n
gcvs
gcvs
gcvs
gcvs
gcvs
gcvs
q()
n
ff
dev.new()
getwd()
q()
n
dim(ob)
dim(obs)
length(obs)
write.csv(format(obs, digits = 16), file = "response.csv")
dim(obs)
getwd()
head(fitted)
dim(fitted)
dim(obs)
dim(obs)
observed[, 123]
observed[, 125]
obs[, 125]
q()
n
response = read.csv("test/data/gsr/05/response.csv")
head(response)
response <- response[, 2:5]
head(response)
response <- as.vector(response)
head(response)
response = read.csv("test/data/gsr/05/response.csv")
response <- response[, 2:5]
response <- as.matrix(response)
colnames(response) <- c()
head(response)
response <- as.vector(response)
head(response)
write.csv(format(response, digits = 16), "test/data/gsr/05/response.csv")
dim(response)
length(response)
ic = as.matrix(Matrix::readMM("test/data/gsr/06/IC.mtx"))
head(ic)
write.csv(format(ic, digits = 16), "test/data/gsr/06/ic.csv")
response = read.csv("test/data/gsr/06/response.csv")
head(response)
response <- as.matrix(response)
colnames(response) <- c()
response <- response[, 3:5]
head(response)
response <- as.vector(response)
head(response)
write.csv(format(response, digits=16), "test/data/gsr/06/response.csv")
design_matrix <- read.csv("test/data/gsr/06/design_matrix.csv")
head(design_matrix)
design_matrix <- as.matrix(design_matrix)
design_matrix <- design_matrix[,2:3]
colnames(design_matrix) <- c()
head(design_matrix)
2120-1590
design_matrix <- design_matrix[530:dim(design_matrix)[1], ]
dim(design_matrix)
head(design_matrix)
design_matrix <- design_matrix[-1, ]
dim(design_matrx)
dim(design_matrix)
head(design_matrix)
write.csv(format(design_matrix, digits=16), "test/data/gsr/06/design_matrix.csv")
field <- as.matrix(Matrix::readMM("test/data/gsr/06/field.mtx"))
dim(field)
1056/4
field <- field[265:dim(field)[1], ]
dim(field)
length(field)
head(field)
792/3
Matrix::writeMM(as.matrix(field), "teset/data/gsr/06/field.mtx")
Matrix::writeMM(Matrix(as.matrix(field)), "teset/data/gsr/06/field.mtx")
write.csv(format(field, digits=16), "test/data/gsr/06/field.csv")
library(Matrix)
Matrix::writeMM(Matrix(as.matrix(field)), "test/data/gsr/06/field.mtx")
writeMM(Matrix(as.matrix(field)), "test/data/gsr/06/field.mtx")
writeMM(Matrix(as.matrix(field), sparse=TRUE), "test/data/gsr/06/field.mtx")
library(fdaPDE)
FAMILY = "gamma"
  inv.link <-  function(mu){ return(-1 / mu)} 
  
  data("horseshoe2D")
  mesh = create.mesh.2D(nodes = horseshoe2D$boundary_nodes,
                        segments = horseshoe2D$boundary_segments)
  mesh = refine.mesh.2D(mesh, maximum_area =  0.025, minimum_angle = 30 )
  FEMbasis = create.FEM.basis(mesh)
  
  f <- function(x, y, t) {
    
    return((-1.5 * sin(2 * pi * x) * cos(2 * pi * y) +
              2 / 5 * sin(3 * pi * x * t) - 2) * (t + 1))
  }
  
  is.in.horseshoe <- function(x, y) {
    r <- .5
    r0 <- .1
    
    if ((x - 3)^2 + (y - r)^2 < (r - r0)^2 & x > 3) {
      return(TRUE)
    }
    if (r0^2 <= x^2 + y^2 & x^2 + y^2 <= (2 * r - r0)^2 & x <= 0) {
      return(TRUE)
    }
    if ((x - 3)^2 + (y + r)^2 < (r - r0)^2 & x > 3) {
      return(TRUE)
    }
    if (abs(y) > r0 & abs(y) < 2 * r - r0 & 0 < x & x <= 3) {
      return(TRUE)
    }
    return(FALSE)
  }
  
  is.p.in.horseshoe <- function(p) {
    return(is.in.horseshoe(p[1], p[2]))
  }
  
  ### generating data ###
  M = 4
  m = M
  n = 400
  
  time_mesh <- seq(0, 1, length.out = M)
  time_locations = time_mesh
  
  set.seed(32)
  
  loc = cbind(runif(2 * n, min = -1, max = 4),
              runif(2 * n, min = -1, max = 1))
  ww <- apply(loc, 1, is.p.in.horseshoe) # ! is.na(fs.test(loc[,1],
  # loc[ ,2], exclude = T))
  loc <- loc[ww, ]  
  
  space_time_locations <-cbind(rep(time_locations, each = nrow(loc)),
                               rep(loc[, 1], length(time_locations)),
                               rep(loc[, 2], length(time_locations)) )
  ### covariates ###
  betas = c(-.2, .3)
  desmat <- matrix(0, nrow = nrow(space_time_locations), ncol = 2)
  desmat[, 1] <- rbeta(n = nrow(desmat), shape1 = 1.5, shape2 = 2)
  desmat[, 2] <- rbeta(n = nrow(desmat), shape1 = 3, shape2 = 2)
  
  true.field <- f(space_time_locations[, 2], space_time_locations[, 3],space_time_locations[, 1])  
  field = true.field + desmat %*% betas 
  
  scale = 1
  data <- rgamma(n = nrow(space_time_locations),
                 shape = -1 / field / scale, scale = scale)
  data <- matrix(data, nrow = nrow(loc), ncol = m)
head(desmat)
lambdaS <- 10^seq(-3, -1, by=0.5)
  lambdaT <- 10^seq(-3, -2, by=0.5)
lambdaS[2]
output_CPP <- smooth.FEM.time(time_mesh = time_mesh, time_locations = time_locations,
                                locations = loc, observations = data,  FEMbasis = FEMbasis, 
                                covariates = desmat,  
                                lambdaS = lambdaS[2], lambdaT = lambdaT[2],
                                family = FAMILY, FLAG_PARABOLIC = T, FLAG_MASS = FALSE)
 ls(output_CPP)
 ls(output_CPP$fit.FEM.time$coeff)
 ls(output_CPP$fit.FEM.time)
 head(output_CPP$fit.FEM.time$coeff)
is(output_CPP$fit.FEM.time$coeff)
output_CPP$fit.FEM.time$coeff
ls
head(data)
ls(output_CPP)
head(output_CPP$ICestimated)
is(output_CPP$ICestimated)
ls(output_CPP$ICestimated)
head(output_CPP$ICestimated$IC.FEM)
head(output_CPP$ICestimated$IC.FEM$coeff)
q()
n
library(fdaPDE)
setwd("test_de_st/test/")
setwd("test_de_st/test/")
!file.exists("STDEPDE_LN/mesh/points.csv")
getwd()
setwd("test/data/de/04/test/")
plot(mesh)
head(initialization)
class(FEMbasis$mesh)
is(FEMbasis$mesh, "mesh.1.5D")
DE.FEM.time
q()
n
setwd("test/data/de/04/test/")
DE.FEM.time
q()
n
